# ロックマン案トランジション設計

## 概要

立ち絵が最初に出現するときの演出。ファミコン版ロックマンのステージ開始演出を着想源とする。

## 着想元

ファミコン版ロックマン（初代〜6あたり）のステージ開始演出：
- ステージ名表示後、キャラクター特有の色の縦線が上から高速で降りてくる
- 縦線が下に到達すると、その場所からロックマンが「生えてくる」ようにフェードイン

## 設計意図

- **用途**: ノベルパート開始時に最初から立ち絵モードの場合
- **印象**: 派手・過剰目の演出（重要なシーンの開始を強調）
- 他のトランジション（SlideTop, SlideBottom, None）との使い分けが可能

---

## 演出仕様

### 動作フロー

```
1. キャラ色のrainBar（縦長のImage）を表示
2. rainBarが上から下へスライド + フェードイン
3. rainBarがフェードアウト
4. 立ち絵がフェードイン（生えてくるように）
```

### タイミング

| フェーズ | 時間 | 内容 |
|----------|------|------|
| 雨バー降下 | 0.35秒 | 上から下へスライド + フェードイン |
| 雨バー消失 | 0.1秒 | フェードアウト |
| 立ち絵登場 | 0.3秒 | フェードイン |
| **合計** | **約0.75秒** | |

### 視覚効果

- 雨バーは縦長の矩形（雨粒のような曖昧なオブジェクト）
- キャラ固有の`themeColor`で着色
- ぼかし効果（blur）で曖昧さを表現

---

## 実装状況

### 実装済み

| ファイル | 内容 | 状態 |
|----------|------|------|
| `PortraitTransition.cs` | `Rockman` enum値 | ✅ |
| `PortraitPresenter.cs` | `PlayRockmanTransition()` メソッド | ✅ |
| `PortraitPresenter.cs` | `leftRainBar`, `rightRainBar` SerializeField | ✅ |
| `PortraitDatabase.cs` | `themeColor` フィールド | ✅ |
| `PortraitDatabase.cs` | `GetThemeColor()` メソッド | ✅ |

### 未実装（シーン設定）

| 項目 | 内容 |
|------|------|
| RainBar用Image配置 | PortraitPresenter配下にleftRainBar/rightRainBar用のImageを配置 |
| SerializeFieldアサイン | PortraitPresenterにRainBar Imageをアサイン |
| themeColor設定 | PortraitDatabaseの各キャラにthemeColorを設定 |

---

## シーン設定手順

### 1. RainBar用Imageの作成

NovelContent配下のPortraitPresenterに、左右それぞれのRainBar用Imageを追加：

```
PortraitPresenter (GameObject)
├── LeftPortrait (Image) - 既存
├── RightPortrait (Image) - 既存
├── LeftRainBar (Image) - 新規追加
└── RightRainBar (Image) - 新規追加
```

### 2. RainBar Imageの設定

| 項目 | 設定値 |
|------|--------|
| Anchor | 立ち絵と同じ位置（左下または右下） |
| Pivot | (0.5, 0) - 下端基準 |
| Width | 20〜30px |
| Height | 100〜150px |
| Sprite | 単色白矩形（UIDefault等） |
| Color | 白（実行時にthemeColorで上書き） |
| Active | false（初期状態で非表示） |

### 3. PortraitPresenterへのアサイン

PortraitPresenterコンポーネントの以下フィールドにアサイン：
- `leftRainBar` ← LeftRainBar
- `rightRainBar` ← RightRainBar

### 4. PortraitDatabaseのthemeColor設定

各キャラクターの`PortraitCharacterData`に`themeColor`を設定：

| キャラ | 推奨色（例） |
|--------|-------------|
| Geino | ピンク系 (#ff6b9d) |
| Noramlia | 青系 (#6b9dff) |
| Sites | 緑系 (#6bff9d) |

---

## 使用方法

### DialogueStepでの指定

```csharp
var step = new DialogueStep
{
    LeftPortrait = new PortraitState
    {
        CharacterId = "geino",
        Expression = "normal",
        TransitionType = PortraitTransition.Rockman  // ← ここで指定
    }
};
```

### 動作確認

1. ノベルパートを起動するイベントを作成
2. 最初のDialogueStepで`TransitionType = Rockman`を指定
3. 立ち絵登場時にロックマン演出が再生されることを確認

---

## 関連ファイル

| ファイル | 役割 |
|----------|------|
| `Assets/Script/Walk/Presentation/PortraitPresenter.cs` | トランジション実行 |
| `Assets/Script/Walk/Data/PortraitDatabase.cs` | キャラデータ（themeColor） |
| `Assets/Script/Walk/Dialogue/PortraitTransition.cs` | enum定義 |
| `Assets/Script/Walk/Dialogue/PortraitState.cs` | 立ち絵状態（TransitionType含む） |

---

## 参考

### HTMLモック

`doc/終了済み/novel_part_mock.html` に技術デモあり。
「立ち絵登場」→「ロックマン案」ボタンで動作確認可能。

### 元設計書の記述

> **案1: ロックマン案（過剰目）**
> - 着想：ファミコン版ロックマンのステージ開始演出
> - キャラ特有の色の縦線（雨粒のような曖昧なオブジェクト）が上から高速で降りてくる
> - 下に着いたら、生えてくるように立ち絵がフェードイン
> - **用途**: ノベルパート開始時に最初から立ち絵の場合

出典: [ノベルパート設計.md](./ノベルパート設計.md) 69-77行目
