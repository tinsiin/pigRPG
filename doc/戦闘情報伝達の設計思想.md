# 戦闘情報伝達の設計思想

## このゲームの前提

このRPGの戦闘は「止まらないこと」が核。

- ボタンを押すと待機時間なしでスキル選択に入れる
- エフェクト再生中もガンガン次の行動を選べる
- 歩行パートもボタン連打でどんどん進められる

この**リズムを絶対に切らない**ことがゲーム体験の前提であり、戦闘中の情報伝達もこの制約の中で設計する。

## 基本方針: 流れの中で気づかせる

「止めて見せる」のではなく、「**流れの中で異常に気づかせる**」。

プレイヤーはボタンを高速連打しながら戦闘を進める。その中で情報を伝えるには、視覚的なシグナルを**既存の描画フローに乗せる**のが正しい。カットインや割り込みダイアログのような「止める」演出はこのゲームに向いていない。

ナラティブな表現（イラスト、カットイン、絵による状況説明）は推理パートやノベルパートで行う。RPG戦闘部分では使わない。

## プレイヤー体験としての2層

情報がプレイヤーに届く順序で分けると2層になる。

### 即時視覚（見れば分かる）

ボタンを押すたびに生成される描画オブジェクト群。矢印、エフェクト、ダメージ数字、被弾点滅など。プレイヤーが最も直感的に受け取る情報。特殊イベント（割り込みカウンター、慣れフラットロゼ等）もこの層で、流れの中に異常なビジュアルを混ぜて「何か起きた」と気づかせる。

### テキスト補足（チラッと見れば分かる）

SchizoLogによるタイプライター表示。即時視覚で伝わった情報の文字による補足。詳細を知りたい時に上を見る程度の存在。仕様書: `doc/SchizoLog仕様書.md`

### カットイン演出（廃案）

当初検討したが、このゲームには合わない。カットインは「止めて見せる」演出であり、連打リズムと矛盾する。止めればリズムが切れ、止めなければ一瞬で消えて誰も見ない。ナラティブな演出が必要な場面はノベルパート・推理パートに委ねる。

## HP変動パス

戦闘中のHP・精神HPの変動は多岐にわたる（攻撃ダメージ、レイザーダメージ、回復、蘇生、互角一撃生存、ダウナー乖離等）。各変動パスの定義と、どの情報伝達層が担うかは `doc/HP変動パス仕様書.md` を参照。

## 実装ロジックとしての4層

上記の体験を実現する**描画の仕組み**で分けると4層になる。それぞれ独立したシステムであり、組み合わせて使う。

### 第1層: 線描画システム（矢印・ポリライン）

アイコン間に矢印を描くのと同じロジックで、あらゆる線的表現を担う。色はステージテーマ色から引用される（歩行システムのサイドオブジェクトと同様）。

| 現在の用途 | 伝える情報 | 実装状況 |
|---|---|---|
| 矢印 | 誰→誰への攻撃。太さでダメージ規模 | 実装済み |
| 武器スラッシュ | 攻撃のビジュアル演出 | 実装済み |

特殊イベント時には同じ仕組みで亀裂・装飾線・アイコンに沿う特殊な線を描ける。

矢印の役割は「誰→誰に」の関係性を一瞬で伝えること。太さで規模感も分かる。このシンプルさを保つため、数字などの情報は乗せない。

### 第2層: エフェクトシステム（JSON定義エフェクト）

`doc/effect_system_manual.md` に詳細。フレームベース/KFXキーフレームベースの汎用エフェクト再生システム。

| 現在の用途 | 伝える情報 | 実装状況 |
|---|---|---|
| スキルエフェクト | スキルの性質・派手さ | 実装済み |
| 被弾点滅 | ダメージを受けたことの即時通知 | 実装済み |

汎用性が非常に高く、特殊イベント用の専用エフェクトもこのシステムで実現できる。

### 第3層: フロー数字（位置依存ポップアップ）

`doc/フロー数字仕様書.md` に詳細。

ターゲットアイコン付近に数字+状況記号をポップアップ表示する。ポップ→上昇→各文字が穏やかに左右へ流れて消滅。攻撃ダメージだけでなく、回復やレイザーダメージなど戦闘中の数値全般を扱う。

- **位置依存**: ターゲットのアイコン付近に出現する（固定UIではない）
- **テキスト**: 数字と記号（!クリティカル、^乱れ、?かすり）+ 白アウトラインで可読性を確保
- **やや永続的**: 上方向にフロートしながら左右に散ってフェードアウト（合計1.55s）

既存の3層のどれとも性質が異なる：
- 線描画（第1層）は線。数字のテキストレンダリングとは別物。矢印のシンプルさを数字で汚したくない
- エフェクト（第2層）はピクセルアートのフレーム描画。テキストの可読性とは別の仕組み
- SchizoLog（第4層）は画面固定位置のログ。ダメージ数字はターゲット付近に出る位置依存表示

**実装状況: 実装済み**

### 第4層: テキストログ（SchizoLog）

`doc/SchizoLog仕様書.md` に詳細。画面上部の固定位置にタイプライター表示されるテキストログ。メッセージ種類を増やすだけで任意の状況を伝達可能。

### 4層の組み合わせ

4つはそれぞれ独立したシステムだが、同時に発動する。例えば1回の攻撃で：
- 第1層: 攻撃者→対象に矢印が引かれる（誰→誰が一目で分かる）
- 第2層: スキルエフェクトが再生される + 被弾点滅（視覚的インパクト）
- 第3層: ターゲット付近に「128!」がポップアップ（ダメージ量+状況が即座に分かる）
- 第4層: SchizoLogに「○○が○○を攻撃した-「128」」と表示される（詳細テキスト補足）

特殊イベント時は、複数の層で異常を出すことで、流れを止めずにインパクトを与えられる。
