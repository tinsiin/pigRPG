# 防御行動の議論と結論

この文書は、狙い流れ（AimStyle）システムにおける「防御がつまらない」問題への議論と、その結論をまとめたもの。

---

## 発端: 防御側に選択肢がない

### 攻撃側のプレイヤー体験

- 武器を**選ぶ** → 戦闘規格が決まる
- スキルを**選ぶ** → ムーブセットが決まる
- 連続攻撃で**畳みかける**

全てプレイヤーの意志で動く。

### 防御側のプレイヤー体験

- 攻撃が来る → `SwitchDefenceStyle()` が**自動で回る**
- 引き締め値が足りていれば**勝手に適応**
- 足りなければ**勝手に失敗**

防御側にはプレイヤーの意思決定が一切介在しない。引き締め値を事前に育てたかどうかだけが結果を左右する。

### 格ゲーとの比較

格闘ゲームでガードを崩されたら「読み負けた！」と思える。それはプレイヤーが**選択した**から。このシステムでは防御に選択がないため、負けても**他人事**に感じる。

---

## 提案1: AimStyle選択付き防御コマンド

### 内容（防御行動.md より）

- 自分のターンで攻撃を放棄し「防御」を選ぶ
- **直接AimStyleを選べる**（どの狙い流れで防ぐか）
- 排他DEFに 1.5〜2倍のランダム倍率（「運命の天秤」）がかかる
- ターン経過で天秤が50%に収束していく（永久に籠もれない）

### 初期評価（一度は無罪判定）

- 攻撃を犠牲にして防御に賭けるトレードオフ → 良い
- プレイヤーがAimStyleを読んで選ぶ → 読み合いの要素が入る
- 天秤の収束で永久防御を防止 → バランス上問題なし

### 覆った理由 — 設計思想の否定

議論の中で、狙い流れの**本質**に気づいた:

> 狙い流れは**神経の反応**である。
> 顔を殴られそうなら顔を庇う。蹴られそうなら下を防ぐ。
> これは**選ぶものではなく、勝手に起こるもの**。

AimStyleをプレイヤーが手動で選ぶのは、**反射を意志で上書きする**こと。目を閉じて「右から来る」と念じるようなもの。`SwitchDefenceStyle` が自動で走るのは、この世界観を表現するための設計であり、バグではない。

### 判決: 有罪（設計思想の否定）

AimStyle選択は狙い流れシステムの根幹である「神経反応」の否定。

---

## 提案2: AimStyle選択なし・DEF倍化のみの防御コマンド

### 内容

- AimStyle選択を除去
- 攻撃を放棄して防御に回り、DEFステータスを2倍にするだけ
- `SwitchDefenceStyle` は通常通り自動で走る

### 評価

**設計思想との矛盾**: なし。AimStyleには触れないので、神経反応の否定にはならない。

**しかし、不要**:

1. **「防御がつまらない」の解決にならない** — 数字が2倍になるだけで、プレイヤー体験は相変わらず「見てるだけ」
2. **パッシブで代替可能** — 防御力アップの効果はパッシブスキルで表現できる
3. **ランダムターン制との相性が悪い** — 誰が次に来るか分からない混戦で、「このターン防御します」の価値が不安定
4. **RPGの防御コマンドは元々空気** — 大抵の作品で特殊な状況でしか使われない

### 判決: 不起訴（害はないが必要もない）

---

## 議論中に発見されたバグ: 単発AimStyleの不等号反転

### 問題

`BaseStates.Damage.cs` の `SwitchDefenceStyle` 内、単発/初回攻撃の防御判定:

```csharp
// 修正前（バグ）
var per = 1f;
if(GetTightenMindCorrectionStage()>=2) per=0.75f;
// → 引き締め値が低い方が100%対応、高い方が75%になっていた
```

### 設計意図（狙い流れ.md）

- 引き締め段階 ≧ 2: **完全対応可能**（100%）
- 引き締め段階 ＜ 2: 7割を外すとランダム（**75%対応、25%ランダム**）

※「7割外す」の解釈: 「7割（の成功ゾーン）を外すとランダムになる」= 70%成功。コードの `0.75` は70%を少し丸めた値。

### 修正

```csharp
// 修正後
var per = 1f;
if(GetTightenMindCorrectionStage()<2) per=0.75f;
// → 不等号を反転。引き締め値が低い時に75%、高い時に100%
```

### 修正後の挙動

| 引き締め段階 | 修正前（バグ） | 修正後 |
|------------|--------------|--------|
| ＜ 2 | 100%成功 | **75%成功 / 25%ランダム** |
| ≧ 2 | 75%成功 | **100%成功（完全対応）** |

---

## 単発攻撃と連続攻撃でのAimStyleの違い

### 共通

- どちらもAimStyleは決定される（a/bの確率ロール）
- 排他DEFはAimStyleで分岐する
- 0.7クランプは両方に効く

### 単発攻撃

- **一発勝負**。引き締め値で即判定
- 成功/失敗が1回で決まる
- 翻弄の余地がない
- a/bどちらが来ても防御成功率は同じ（a/bは防御成功率に影響しない）

### 連続攻撃

- `AimStyleMemory` による**段階的適応**
- `DefenseTransformationThresholds` で切替難易度が変わる
- 引き締め値が高いほど適応が速い
- 攻撃者がa/bを織り交ぜて**翻弄**できる
- **狙い流れシステムの真骨頂**

### 結論

AimStyleは単発にも効くが、このシステムが本当に輝くのは連続攻撃。連続攻撃の「翻弄」と「適応」の駆け引きこそが狙い流れの本質。

---

## ランダムターン制との根本的な非互換性

### このゲームのターン制

```
1. 陣営コイントス: 50%で味方 / 50%で敵
2. 選ばれた陣営から、リカバリーターン完了済みのキャラをフィルタ
3. その中からランダムに1人選出
4. 行動後、リカバリーターンのカウンタをリセット
```

速さステータスは存在しない。誰が次に来るかは完全にランダム。テーマは「想像の加速、混戦」。ボクシングやアニメの戦闘シーンのように、ほぼ同時に殴り合っている世界。

### リカバリーターン

行動後、一定ターン数が経過するまで次のターン候補に入れない仕組み。

- `maxRecoveryTurn`: キャラごとの基礎値
- パッシブで加減算可能
- 前衛（Vanguard）は進行速度2倍（より頻繁に行動）
- スキル使用時に一時的なクールダウン加算あり

### 防御コマンドが成立しない理由

**ランダムターン = 攻撃チャンス。** ターンは「義務的に回ってくる順番」ではなく「降ってきたチャンス」。このチャンスを防御に使うのは**機会の浪費**。

| 問題 | 説明 |
|------|------|
| **チャンスの浪費** | ランダムで回ってきた貴重なターンを防御に使うのは死に行動 |
| **「1ターン」が定義不能** | 次に自分のターンが来るまでに敵が何回行動するか不明。「1ターン防御」の「1ターン」が存在しない |
| **味方ターンとの重複** | 自分が防御してる間に味方のターンが来る。何もせず見てるだけ |
| **連続で自分が来る可能性** | ランダムだから次もすぐ自分の番かもしれない。防御する意味がさらに薄れる |

従来のRPGは `自分→敵→自分→敵` と交互だから「次の1回を耐える」が成立する。このゲームは `自分→敵A→敵B→敵A→味方B→敵C→自分` のように不定だから、防御の持続期間が設計できない。

### パッシブが防御コマンドの完全上位互換である理由

| 防御コマンド | パッシブ |
|------------|---------|
| 攻撃チャンスを消費する | **行動を消費しない** |
| 「次のターンまで」= ランダムで不定 | **ターン数を明示的に指定可能** |
| ただのDEF倍率 | **キャラ固有の防御表現**（プロパティが豊富） |
| キャラの個性が出ない | スキルごとに独自の防御の色が出せる |
| 死に行動になりやすい | 攻撃しながら防御効果も得られる |

パッシブは行動を消費せず、明示的なターン数指定があり、ターン数以外の解除条件も設定でき、キャラの独自色を出せる。防御コマンドでやりたいことは全てパッシブで**より良く**実現可能。

---

## 最終結論

### 防御コマンドは不要

以下の理由から、防御専用コマンドの追加は不要と判断。

**1. 世界観の整合性 — AimStyleは神経反応**

狙い流れは神経の反応であり、意志で選ぶものではない。ランダムターン制（速さステータスなし）による混戦の中で、体が勝手に反応する — これがこのゲームの戦闘の本質。「想像の加速、混戦」というテーマと、自動防御システムは完全に一致している。

**2. ランダムターン制との根本的非互換**

ランダムターンの本質は「チャンスが来たら殴れ」。防御でチャンスを捨てるのは死に行動。「次のターンまで」が不定である以上、防御の持続期間を設計できない。

**3. パッシブで完全に代替可能**

防御力強化はパッシブスキルで表現できる。ターン数の明示指定、行動を消費しない、キャラの個性が出る、プロパティが豊富 — 全てにおいてパッシブが上位互換。リカバリーターン（次のターン候補リストから外れる期間）も既に実装済みで、防御的な「間」は存在する。

**4. 問題は仕組みではなく見せ方**

防御が「つまらない」のは、防御の**結果がプレイヤーに伝わっていない**から。仕組みを変えるのではなく、演出で体験を改善すべき。

---

## 提案: 防御の演出・フィードバック強化

防御を「つまらない」から「見ていて分かる」に変えるための方向性。

### AimStyle対応の可視化

- **「対応成功！」** — 正しいAimStyleに切り替わった瞬間の演出
- **「対応遅れ！」** — 連続攻撃中にまだ適応しきれていない状態の表示
- **「完全対応」** — 引き締め段階≧2で初回から正しく防いだ時の特別演出

### 0.7クランプの可視化

- 不適切な防ぎ方で0.7クランプが発動した時、**なぜ痛かったかが分かる表示**
- 例:「防ぎ方不一致 — 防御力70%に制限」のような情報
- ゴリ押し（パワーhigh超）でクランプを無視した場合も、その旨を表示

### 成長の実感

- 引き締め値が育って**初回対応できるようになった瞬間**の達成感演出
- 以前は対応できなかったAimStyleに対応できるようになった、という変化が**目に見える**
- 十日能力の成長 → 排他DEFの向上が、防御結果の変化として体感できる

### 連続攻撃中の適応過程

- AimStyleMemoryが蓄積されていく様子を視覚的に表現
- 「あと少しで対応できる」というテンション
- 対応完了の瞬間の「読み切った！」感

### 設計方針

**選ばせなくても、見せ方で体験は変わる。** 仕組みは壊れていない。神経反応という設計思想を活かしたまま、その結果をプレイヤーに伝える演出を追加する方向で検討する。
