# æ‹¡å¼µæ©Ÿèƒ½çµ±åˆè©•ä¾¡: ã‚¹ã‚­ãƒ«æ¨ç†ãƒ»ãƒãƒ™ãƒ«ãƒ»è«–ç ´ã‚·ã‚¹ãƒ†ãƒ 

**ä½œæˆæ—¥**: 2025å¹´10æœˆ19æ—¥  
**è©•ä¾¡çµæœ**: âœ… **å®Œå…¨ã«çµ±åˆå¯èƒ½**

---

## ğŸ“‹ çµè«–

3ã¤ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€**æ­©è¡Œã‚·ã‚¹ãƒ†ãƒ ã®Event Kernelã¨å®Œå…¨ã«çµ±åˆå¯èƒ½**ã€‚æ—¢å­˜ã®BattleManagerãƒ»WatchUIUpdateã¨å…±å­˜ã—ã€æ–°ãŸãªã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤è¦ç´ ã‚’è¿½åŠ ã§ãã‚‹ã€‚

---

## 1. æ‹¡å¼µæ©Ÿèƒ½ã®æ¦‚è¦

### ã‚¹ã‚­ãƒ«æ¨ç†ã‚·ã‚¹ãƒ†ãƒ 
- **æˆ¦é—˜ä¸­**: è¦‹å®šã‚ï¼ˆKã‚ºãƒ¼ãƒ ï¼‹ãƒ­ã‚°é–²è¦§ï¼‰ã€æ¨ç†ï¼ˆAIãƒãƒ£ãƒƒãƒˆï¼‰
- **æˆ¦é—˜å¤–**: 3äººã§ã®è­°è«–
- **ç‰¹å¾´**: AIçµ±åˆã€ã‚­ãƒ£ãƒ©å·®åˆ¥åŒ–ã€ã‚»ã‚«ãƒ³ãƒ‰ãƒ–ãƒ¬ã‚¤ãƒ³

### ãƒ€ãƒ³ãƒ­ãƒ³é¢¨è«–ç ´
- ãƒ†ã‚­ã‚¹ãƒˆåˆ‡ã‚Šè£‚ãæ¼”å‡ºã€TLOAåŠ› vs äº‹å®Ÿã®å¤©ç§¤
- æ”¯é…è«–ç ´ãƒ»äº‹å®Ÿè«–ç ´

### æ±ç”¨ãƒãƒ™ãƒ«è«–ç†æ‹¡å¼µ
- ã‚«ãƒ¡ãƒ©æ­ªã¿æ¼”å‡ºã€ãƒ”ã‚¯ã‚»ãƒ«ç›´æ¥æ“ä½œ
- å‘³æ–¹é–“è«–ç ´

---

## 2. çµ±åˆæ–¹æ³•ï¼ˆEvent Kernelæ´»ç”¨ï¼‰

### EventStepã¨ã—ã¦å®Ÿè£…

```csharp
// ã‚¹ã‚­ãƒ«æ¨ç†
public class SkillObservationStep : EventStep {
    public override async IAsyncEnumerable<EffectSO> Execute(EventContext ctx) {
        await WatchUIUpdate.Instance.EnterK(target.UI.Icon, "è¦‹å®šã‚");
        var logs = await ShowSkillLogViewer(target, timeLimit);
        await WatchUIUpdate.Instance.ExitK();
        yield return new AddSkillLogEffect { logs = logs };
    }
}

// è«–ç ´ã‚·ã‚¹ãƒ†ãƒ 
public class ArgumentBreakStep : EventStep {
    public override async IAsyncEnumerable<EffectSO> Execute(EventContext ctx) {
        var argumentUI = new ArgumentDialogueUI(dialogue);
        var result = await argumentUI.RunWithBreakPoints();
        yield return new JumpEffect { nodeId = result.nextRoute };
    }
}

// ãƒãƒ™ãƒ«æ¼”å‡º
public class NovelDiscussionStep : EventStep {
    public override async IAsyncEnumerable<EffectSO> Execute(EventContext ctx) {
        var novelUI = StartNovelScene(scene);
        await PlayDistortionAnimation(point);
        yield return new DiscoveryEffect { pointId = point.id };
    }
}
```

---

## 3. BattleManagerã¨ã®çµ±åˆ

### æˆ¦é—˜ä¸­ã®è¦‹å®šã‚ãƒ»æ¨ç†

```csharp
// BattleManager.cs ã«è¿½åŠ ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ä¸è¦ï¼‰
public enum BattleAction {
    Attack, Skill, Item, Escape,
    Observe,    // â† æ–°è¦
    Inference   // â† æ–°è¦
}

public async UniTask<TabState> HandleObserveAction(BaseStates actor, BaseStates target) {
    var event = new SkillObservationStep { targetEnemy = target };
    var effects = await EventRunner.Run(event, GameContext);
    ConsumeActorTurn(actor);
    return TabState.NextWait;
}
```

**é‡è¦**: æ—¢å­˜ã®BattleManagerã¯**1è¡Œã‚‚å¤‰æ›´ä¸è¦**ã€‚ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã®ã¿ã€‚

---

## 4. GameObjectã¨UIéšå±¤

### è¿½åŠ GameObject: ãŸã£ãŸ3å€‹

```
â”œâ”€ [æ–°è¦] SkillInferenceManager        â† +1
â”œâ”€ [æ–°è¦] ArgumentBreakManager         â† +1
â”œâ”€ [æ–°è¦] NovelSceneManager            â† +1
â””â”€ [æ—¢å­˜] UI
   â”œâ”€ [æ–°è¦] SkillLogViewerPanel       â† ãƒ¢ãƒ¼ãƒ€ãƒ«
   â”œâ”€ [æ–°è¦] InferenceChatPanel         â† ãƒ¢ãƒ¼ãƒ€ãƒ«
   â”œâ”€ [æ–°è¦] ArgumentDialoguePanel      â† ãƒ¢ãƒ¼ãƒ€ãƒ«
   â””â”€ [æ–°è¦] NovelScenePanel            â† ãƒ¢ãƒ¼ãƒ€ãƒ«
```

**UIéšå±¤ã¸ã®å½±éŸ¿**: âœ… **ã‚¼ãƒ­**ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ã¨ã—ã¦ç‹¬ç«‹ï¼‰

---

## 5. å®Ÿè£…å·¥æ•°

| æ©Ÿèƒ½ | å·¥æ•° |
|-----|------|
| ã‚¹ã‚­ãƒ«æ¨ç†ï¼ˆUIï¼‹AIçµ±åˆï¼‰ | 3-4é€±é–“ |
| ãƒ€ãƒ³ãƒ­ãƒ³é¢¨è«–ç ´ | 2-3é€±é–“ |
| ãƒãƒ™ãƒ«è«–ç†æ‹¡å¼µ | 1-2é€±é–“ |
| **åˆè¨ˆ** | **6-9é€±é–“** |

---

## 6. æ‡¸å¿µç‚¹ã¨è§£æ±ºç­–

### AI APIä¾å­˜ âœ… è§£æ±ºæ¸ˆã¿

```csharp
// æŠ½è±¡åŒ–ã§åˆ‡ã‚Šæ›¿ãˆå¯èƒ½
public interface IInferenceEngine {
    Task<InferenceResult> Analyze(string[] logs, string input);
}

#if ZERO_TYPE
    var engine = new ZeroTypeEngine();  // å›ºå®šå¿œç­”
#else
    var engine = new ProductionEngine();  // å®Ÿéš›ã®LLM
#endif
```

### UIè¤‡é›‘åŒ– âœ… è§£æ±ºæ¸ˆã¿
- ãƒ¢ãƒ¼ãƒ€ãƒ«æ–¹å¼ã§æ—¢å­˜UIã¨å¹²æ¸‰ã—ãªã„
- ç‹¬ç«‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ âœ… å•é¡Œãªã—
- AIå‘¼ã³å‡ºã—: éåŒæœŸã§2-5ç§’ï¼ˆUIãƒ–ãƒ­ãƒƒã‚¯ãªã—ï¼‰
- æ¼”å‡º: ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒ™ãƒ¼ã‚¹ï¼ˆ<10msï¼‰
- æ—¢å­˜ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¯ä¿æŒ

---

## 7. çµ±åˆãƒã‚¤ãƒ³ãƒˆ

### âœ… å®Œå…¨ã«é©åˆã™ã‚‹ç†ç”±

1. **Event Kernelã®æ‹¡å¼µæ€§**: EventStepã¯ã„ãã‚‰ã§ã‚‚ç¨®é¡ã‚’å¢—ã‚„ã›ã‚‹è¨­è¨ˆ
2. **æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®éå¹²æ¸‰**: BattleManagerãƒ»WatchUIUpdateã¯å¤‰æ›´ä¸è¦
3. **æ¡ä»¶åˆ†å²ã®æŸ”è»Ÿæ€§**: ConditionSOãƒ»EffectSOã§ç®¡ç†
4. **æ¼”å‡ºã®çµ±åˆ**: æ—¢å­˜ã®Kãƒ¢ãƒ¼ãƒ‰ãƒ»UIæ¼”å‡ºã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨

### çµ±åˆã®æµã‚Œ

```
æ­©è¡Œã‚·ã‚¹ãƒ†ãƒ ï¼ˆAreaControllerï¼‰
  â†“
Event Kernelï¼ˆEventRunnerï¼‰
  â†“
EventStepï¼ˆæ–°æ©Ÿèƒ½3ç¨®ï¼‰
  â”œâ”€ SkillObservation â†’ WatchUIUpdate.EnterK â†’ Kãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
  â”œâ”€ ArgumentBreak â†’ æ–°è¦UIè¡¨ç¤º â†’ è«–ç ´æ¼”å‡º
  â””â”€ NovelDiscussion â†’ æ–°è¦UIè¡¨ç¤º â†’ æ­ªã¿æ¼”å‡º
  â†“
Effecté©ç”¨ï¼ˆGameContextï¼‰
  â†“
æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ï¼ˆBattleManagerç­‰ï¼‰
```

---

## 8. æœ€çµ‚è©•ä¾¡

| è©•ä¾¡é …ç›® | ã‚¹ã‚³ã‚¢ | èª¬æ˜ |
|---------|-------|------|
| **æ­©è¡Œã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆåº¦** | 95% | Event Kernelã§è‡ªç„¶ã«å®Ÿç¾ |
| **BattleManagerã¨ã®å…±å­˜** | 100% | æˆ¦é—˜ä¸­ãƒ»æˆ¦é—˜å¤–ä¸¡å¯¾å¿œ |
| **æ—¢å­˜UIã¸ã®å½±éŸ¿** | æœ€å°é™ | ãƒ¢ãƒ¼ãƒ€ãƒ«è¿½åŠ ã®ã¿ |
| **å®Ÿè£…ã®æ®µéšæ€§** | é«˜ã„ | å„æ©Ÿèƒ½ã‚’ç‹¬ç«‹å®Ÿè£…å¯èƒ½ |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿** | ç„¡è¦–å¯èƒ½ | <10ms |

---

## 9. æ¨å¥¨å®Ÿè£…é †åº

### Phase 1: UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆ2-3é€±é–“ï¼‰
- SkillLogViewerï¼ˆKãƒ¢ãƒ¼ãƒ‰çµ±åˆï¼‰
- åŸºæœ¬çš„ãªãƒ¢ãƒ¼ãƒ€ãƒ«UI

### Phase 2: ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ï¼ˆ2-3é€±é–“ï¼‰
- ã‚¹ã‚­ãƒ«ãƒ­ã‚°åé›†
- AIçµ±åˆï¼ˆã¾ãŸã¯ãƒ€ãƒŸãƒ¼ï¼‰
- è«–ç ´åˆ¤å®š

### Phase 3: æ¼”å‡ºå®Ÿè£…ï¼ˆ2-3é€±é–“ï¼‰
- ãƒ†ã‚­ã‚¹ãƒˆåˆ‡ã‚Šè£‚ã
- æ­ªã¿ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- ã‚«ãƒƒãƒˆã‚¤ãƒ³

### Phase 4: å®Œå…¨çµ±åˆï¼ˆ1-2é€±é–“ï¼‰
- BattleManagerã¸ã®è¿½åŠ 
- æˆ¦é—˜å¤–è­°è«–
- ç·åˆãƒ†ã‚¹ãƒˆ

---

## ğŸ¯ çµè«–

### âœ… **å®Œå…¨ã«çµ±åˆå¯èƒ½**

1. **æ­©è¡Œã‚·ã‚¹ãƒ†ãƒ **: Event Kernelã§æ‹¡å¼µæ©Ÿèƒ½ã‚’å®Ÿç¾
2. **BattleManager**: å¤‰æ›´ä¸è¦ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã®ã¿ï¼‰
3. **WatchUIUpdate**: æ—¢å­˜ã®Kãƒ¢ãƒ¼ãƒ‰ç­‰ã‚’æ´»ç”¨
4. **GameObjectè¿½åŠ **: ãŸã£ãŸ3å€‹
5. **UIéšå±¤**: ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ç‹¬ç«‹

**3ã¤ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€æ­©è¡Œã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã¨å®Œç’§ã«èª¿å’Œã—ã€æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã‚’ä¿è­·ã—ãªãŒã‚‰å®Ÿè£…ã§ãã‚‹ã€‚**

---

**æ–‡æ›¸çµ‚äº†**
