# ゼロトタイプ歩行システム仕様書

本書は実装の詳細仕様を記録する。設計意図については「ゼロトタイプ歩行システム設計書」を参照。

---

## イベント門と出口の位置計算（ハードル並び設計）

### 概要

イベント門と出口は「ハードルの並び」として設計されている。各障壁は前の障壁を越えた先に配置され、設定値がそのまま「越えるべき距離」となる。

### 位置の解釈

| 要素 | 設定値の意味 | 実際の出現位置 |
|------|-------------|---------------|
| イベント門 | 開始地点からの絶対位置 | `TrackProgress >= 設定値` |
| 出口 | 最後の門からの相対距離 | `TrackProgress >= 最大門位置 + 設定値` |

### 計算式

```
出口の実際位置 = max(全門の解決位置) + 出口の設定歩数
```

門がない場合は `max = 0` となり、出口の設定値がそのまま絶対位置となる。

### 具体例

**設定:**
- 門1: 30歩
- 門2: 50歩
- 出口: 100歩

**実際の動作:**
1. 開始（TrackProgress=0）
2. 30歩で門1出現
3. 50歩で門2出現
4. 門2通過後「あと100歩」と表示
5. 150歩（= max(30,50) + 100）で出口出現

### 設計意図

- 門と出口を独立して設定可能（兼ね合いを考える必要がない）
- 「門を100歩に、出口を50歩に」と設定すれば、門通過後50歩で出口が出る
- 直感的な数値設定が可能

### 関連コード

- `GateResolver.GetMaxResolvedPosition()` - 最大門位置の取得
- `ExitSpawnRule.ShouldSpawn()` - 出口出現判定
- `ProgressCalculator.CalculateExitPosition()` - 出口位置計算
