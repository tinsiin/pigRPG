# 味方バトルアイコン仕様書

## 概要

バトル画面に表示される味方キャラクターのアイコン（BattleIconUI）の設定方法と画像規格を定義する。

## 画像規格

### アイコン画像サイズ

| 項目 | 値 |
|------|-----|
| **推奨サイズ** | 476 x 722 px |
| **アスペクト比** | 約 0.66:1 (縦長) |
| **ファイル形式** | PNG (透過対応) |
| **Texture Type** | Sprite (2D and UI) |

### 設定例

現在のオリジナルメンバーアイコン:
- `charactorIcon.png` - 476 x 722 px
- `geino.png` - 476 x 722 px
- `normlia.png` - 476 x 722 px

全て同一サイズで統一されている。

## キャラクター設定

### AllyClass での設定

バトルアイコンスプライトは `AllyClass` で管理する。

**ファイル**: `Assets/Script/Players/Runtime/AllyClass.cs`

```csharp
[Header("バトルアイコン")]
[Tooltip("戦闘中に表示するキャラクターアイコン（規格: 476 x 722 px）")]
[SerializeField] private Sprite _battleIconSprite;

/// <summary>
/// バトルアイコンスプライトを取得する
/// </summary>
public Sprite BattleIconSprite => _battleIconSprite;
```

### 設定手順

1. **スプライト画像を準備**
   - 476 x 722 px のPNG画像を作成
   - `Assets/` 以下の適切なフォルダに配置

2. **Texture Import設定**
   - Inspector で `Texture Type` を `Sprite (2D and UI)` に設定
   - `Sprite Mode` は `Single`
   - `Pixels Per Unit` は `100` (デフォルト)

3. **AllyClassテンプレートに設定**
   - キャラクターの AllyClass プレハブ/アセットを開く
   - `Battle Icon Sprite` フィールドにスプライトをドラッグ&ドロップ

4. **DeepCopyでの複製**
   - ゲーム実行時、テンプレートから `DeepCopyTo()` で複製される際に
   - `_battleIconSprite` も参照コピーされる

## UI配置システム

### スロット構成

```
┌──────────────┬──────────────┬──────────────┐
│     Left     │    Center    │    Right     │
│   (Slot 0)   │   (Slot 1)   │   (Slot 2)   │
│              │              │              │
│   Sites      │    Geino     │   Normlia    │
│  (固定位置)   │   (固定位置)  │   (固定位置)  │
└──────────────┴──────────────┴──────────────┘
```

### オリジナルメンバー固定位置

| キャラクター | CharacterId | 固定スロット |
|-------------|-------------|-------------|
| Sites | `Sites` | Left (0) |
| Geino | `Geino` | Center (1) |
| Normlia | `Normlia` | Right (2) |

### 新メンバーの配置ルール

1. オリジナルメンバーは常に固定位置に配置される
2. 新メンバーは空いているスロットに左から順に配置される
3. パーティは最大3人まで

#### 配置例

**例1: オリジナル3人**
```
パーティ: [Geino, Normlia, Sites]
結果: Left=Sites, Center=Geino, Right=Normlia
```

**例2: Normliaが抜けて新メンバーA**
```
パーティ: [Geino, NewMemberA, Sites]
結果: Left=Sites, Center=Geino, Right=NewMemberA
```

**例3: 全員新メンバー**
```
パーティ: [NewA, NewB, NewC]
結果: Left=NewA, Center=NewB, Right=NewC
```

## シーン上のBattleIconUI

### 配置場所

```
AlwaysCanvas
└── EyeArea
    └── ViewportArea
        └── FrontFixedContainer
            └── BattleContent
                └── Charas
                    ├── LeftBattleIcon
                    ├── CenterBattleIcon
                    └── RightBattleIcon
```

### RectTransform設定

全スロット共通:

| プロパティ | 値 |
|-----------|-----|
| Anchor Min | (0.5, 0.5) |
| Anchor Max | (0.5, 0.5) |
| Pivot | (0.5, 0.5) |
| Size Delta | 100 x 100 |

各スロットの位置:

| スロット | Anchored Position |
|---------|-------------------|
| Left | (-135.32, 14.36) |
| Center | (96.0, 14.36) |
| Right | (324.36, 36.90) |

### PlayersUIRefsでの参照

**ファイル**: `Assets/Script/Players/UI/PlayersUIRefs.cs`

```csharp
[Header("バトルアイコンUIスロット")]
[Tooltip("スロット順: Left(0), Center(1), Right(2)")]
public BattleIconUI[] BattleIconSlots = new BattleIconUI[3];
```

Inspector で3つのBattleIconUIを順番に登録:
- Element 0: LeftBattleIcon
- Element 1: CenterBattleIcon
- Element 2: RightBattleIcon

## BattleIconUI コンポーネント

### 主要プロパティ

| フィールド | 型 | 説明 |
|-----------|-----|------|
| HPBar | CombinedStatesBar | HP/MentalHPバー |
| Icon | Image | アイコン画像 |
| verticalBob | RectTransform | 縦揺れアニメ用 |
| arrowGrowAndVanish | ArrowGrowAndVanish | 矢印エフェクト |
| numberEffect | IconButtonLinkNumberEffect | 番号エフェクト |

### SetIconSprite メソッド

```csharp
/// <summary>
/// アイコン画像を設定する
/// </summary>
public void SetIconSprite(Sprite sprite)
{
    if (Icon != null && sprite != null)
    {
        Icon.sprite = sprite;
    }
}
```

実行時に `PartyUISlotManager` から呼び出され、AllyClassのスプライトが設定される。

## 関連ファイル

| ファイル | 役割 |
|---------|------|
| `Assets/Script/Players/Runtime/AllyClass.cs` | バトルアイコンスプライト保持 |
| `Assets/Script/EYEAREA_UI/BattleIconUI.cs` | バトルアイコンUIコンポーネント |
| `Assets/Script/Players/PlayersRuntime.cs` | PartyUISlotManager（スロット配置管理） |
| `Assets/Script/Players/UI/PlayersUIRefs.cs` | BattleIconSlots参照 |

## 新キャラクター追加時のチェックリスト

1. [ ] 476 x 722 px のアイコン画像を作成
2. [ ] Texture TypeをSprite (2D and UI)に設定
3. [ ] AllyClassテンプレートの `_battleIconSprite` に設定
4. [ ] （オリジナルメンバーの場合）PartyUISlotManagerに固定位置を追加
